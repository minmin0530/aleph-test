import{BSONTypeError as k}from"/-/deno.land/x/web_bson@v0.2.3/src/error.ts?v=l7tvw53z";import{Long as t}from"/-/deno.land/x/web_bson@v0.2.3/src/long.ts?v=l7tvw53z";var z=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,C=/^(\+|-)?(Infinity|inf)$/i,D=/^(\+|-)?NaN$/i;var q=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),B=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),O=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),P=/^([-+])?(\d+)?$/;function J(w){return!isNaN(parseInt(w,10))}function Q(w){let e=t.fromNumber(1e9),n=t.fromNumber(0);if(!w.parts[0]&&!w.parts[1]&&!w.parts[2]&&!w.parts[3])return{quotient:w,rem:n};for(let s=0;s<=3;s++)n=(n=n.shiftLeft(32)).add(new t(w.parts[s],0)),w.parts[s]=n.div(e).low,n=n.modulo(e);return{quotient:w,rem:n}}function Z(w,e){if(!w&&!e)return{high:t.fromNumber(0),low:t.fromNumber(0)};let n=w.shiftRightUnsigned(32),s=new t(w.getLowBits(),0),i=e.shiftRightUnsigned(32),d=new t(e.getLowBits(),0),y=n.multiply(i),u=n.multiply(d),c=s.multiply(i),b=s.multiply(d);return y=y.add(u.shiftRightUnsigned(32)),u=new t(u.getLowBits(),0).add(c).add(b.shiftRightUnsigned(32)),y=y.add(u.shiftRightUnsigned(32)),b=u.shiftLeft(32).add(new t(b.getLowBits(),0)),{high:y,low:b}}function F(w,e){let n=w.high>>>0,s=e.high>>>0;if(n<s)return!0;if(n===s){let i=w.low>>>0,d=e.low>>>0;if(i<d)return!0}return!1}function A(w,e){throw new k(`"${w}" is not a valid Decimal128 string - ${e}`)}var G=Symbol.for("Deno.customInspect"),v=class{static fromString(e){let n=!1,s=!1,i=!1,d=0,y=0,u=0,c=0,b=0,o=[0],l=0,R=0,S=0,a=0,m=0,j=0,$=new t(0,0),g=new t(0,0),U=0,r=0;if(e.length>=7e3)throw new k(`${e} not a valid Decimal128 string`);let N=e.match(z),M=e.match(C),T=e.match(D);if(!N&&!M&&!T||e.length===0)throw new k(`${e} not a valid Decimal128 string`);if(N){let f=N[2],E=N[4],I=N[5],x=N[6];E&&x===void 0&&A(e,"missing exponent power"),E&&f===void 0&&A(e,"missing exponent base"),E===void 0&&(I||x)&&A(e,"missing e before exponent")}if((e[r]==="+"||e[r]==="-")&&(n=e[r++]==="-"),!J(e[r])&&e[r]!=="."){if(e[r]==="i"||e[r]==="I")return new v(new Uint8Array(n?B:O));if(e[r]==="N")return new v(new Uint8Array(q))}for(;J(e[r])||e[r]===".";){if(e[r]==="."){s&&A(e,"contains multiple periods"),s=!0,r+=1;continue}l<34&&(e[r]!=="0"||i)&&(i||(b=y),i=!0,o[R++]=parseInt(e[r],10),l+=1),i&&(u+=1),s&&(c+=1),y+=1,r+=1}if(s&&!y)throw new k(`${e} not a valid Decimal128 string`);if(e[r]==="e"||e[r]==="E"){let f=e.substr(++r).match(P);if(!f||!f[2])return new v(new Uint8Array(q));m=parseInt(f[0],10),r+=f[0].length}if(e[r])return new v(new Uint8Array(q));if(S=0,l){if(a=l-1,(d=u)!==1)for(;o[b+d-1]===0;)d-=1}else S=0,a=0,o[0]=0,u=1,l=1,d=0;for(m=m<=c&&c-m>16384?-6176:m-c;m>6111;){if((a+=1)-S>34){if(o.join("").match(/^0+$/)){m=6111;break}A(e,"overflow")}m-=1}for(;m<-6176||l<u;){if(a===0&&d<l){m=-6176,d=0;break}if(l<u?u-=1:a-=1,m<6111)m+=1;else{if(o.join("").match(/^0+$/)){m=6111;break}A(e,"overflow")}}if(a-S+1<d){let f=y;s&&(b+=1,f+=1),n&&(b+=1,f+=1);let E=parseInt(e[b+a+1],10),I=0;if(E>=5&&(I=1,E===5)){for(I=o[a]%2==1?1:0,j=b+a+2;j<f;j++)if(parseInt(e[j],10)){I=1;break}}if(I){let x=a;for(;x>=0;x--)if(++o[x]>9&&(o[x]=0,x===0)){if(!(m<6111))return new v(new Uint8Array(n?B:O));m+=1,o[x]=1}}}if($=t.fromNumber(0),g=t.fromNumber(0),d===0)$=t.fromNumber(0),g=t.fromNumber(0);else if(a-S<17){let f=S;for(g=t.fromNumber(o[f++]),$=new t(0,0);f<=a;f++)g=(g=g.multiply(t.fromNumber(10))).add(t.fromNumber(o[f]))}else{let f=S;for($=t.fromNumber(o[f++]);f<=a-17;f++)$=($=$.multiply(t.fromNumber(10))).add(t.fromNumber(o[f]));for(g=t.fromNumber(o[f++]);f<=a;f++)g=(g=g.multiply(t.fromNumber(10))).add(t.fromNumber(o[f]))}let L=Z($,t.fromString("100000000000000000"));L.low=L.low.add(g),F(L.low,g)&&(L.high=L.high.add(t.fromNumber(1))),U=m+6176;let h={low:t.fromNumber(0),high:t.fromNumber(0)};L.high.shiftRightUnsigned(49).and(t.fromNumber(1)).equals(t.fromNumber(1))?(h.high=h.high.or(t.fromNumber(3).shiftLeft(61)),h.high=h.high.or(t.fromNumber(U).and(t.fromNumber(16383).shiftLeft(47))),h.high=h.high.or(L.high.and(t.fromNumber(0x7fffffffffff)))):(h.high=h.high.or(t.fromNumber(16383&U).shiftLeft(49)),h.high=h.high.or(L.high.and(t.fromNumber(562949953421311)))),h.low=L.low,n&&(h.high=h.high.or(t.fromString("9223372036854775808")));let p=new Uint8Array(16);return r=0,p[r++]=255&h.low.low,p[r++]=h.low.low>>8&255,p[r++]=h.low.low>>16&255,p[r++]=h.low.low>>24&255,p[r++]=255&h.low.high,p[r++]=h.low.high>>8&255,p[r++]=h.low.high>>16&255,p[r++]=h.low.high>>24&255,p[r++]=255&h.high.low,p[r++]=h.high.low>>8&255,p[r++]=h.high.low>>16&255,p[r++]=h.high.low>>24&255,p[r++]=255&h.high.high,p[r++]=h.high.high>>8&255,p[r++]=h.high.high>>16&255,p[r++]=h.high.high>>24&255,new v(p)}toString(){let e,n=0,s=Array(36);for(let r=0;r<s.length;r++)s[r]=0;let i=0,d=!1,y,u={parts:[0,0,0,0]},c,b,o=[];i=0;let l=this.bytes,R=l[i++]|l[i++]<<8|l[i++]<<16|l[i++]<<24,S=l[i++]|l[i++]<<8|l[i++]<<16|l[i++]<<24,a=l[i++]|l[i++]<<8|l[i++]<<16|l[i++]<<24,m=l[i++]|l[i++]<<8|l[i++]<<16|l[i++]<<24;i=0,{low:new t(R,S),high:new t(a,m)}.high.lessThan(t.ZERO)&&o.push("-");let $=m>>26&31;if($>>3==3){if($===30)return`${o.join("")}Infinity`;if($===31)return"NaN";e=m>>15&16383,y=8+(m>>14&1)}else y=m>>14&7,e=m>>17&16383;let g=e-6176;if(u.parts[0]=(16383&m)+((15&y)<<14),u.parts[1]=a,u.parts[2]=S,u.parts[3]=R,u.parts[0]===0&&u.parts[1]===0&&u.parts[2]===0&&u.parts[3]===0)d=!0;else for(b=3;b>=0;b--){let r=0,N=Q(u);if(u=N.quotient,r=N.rem.low)for(c=8;c>=0;c--)s[9*b+c]=r%10,r=Math.floor(r/10)}if(d)n=1,s[i]=0;else for(n=36;!s[i];)n-=1,i+=1;let U=n-1+g;if(U>=34||U<=-7||g>0){if(n>34)return o.push("0"),g>0?o.push(`E+${g}`):g<0&&o.push(`E${g}`),o.join("");o.push(`${s[i++]}`),(n-=1)&&o.push(".");for(let r=0;r<n;r++)o.push(`${s[i++]}`);o.push("E"),U>0?o.push(`+${U}`):o.push(`${U}`)}else if(g>=0)for(let r=0;r<n;r++)o.push(`${s[i++]}`);else{let r=n+g;if(r>0)for(let N=0;N<r;N++)o.push(`${s[i++]}`);else o.push("0");for(o.push(".");r++<0;)o.push("0");for(let N=0;N<n-Math.max(r-1,0);N++)o.push(`${s[i++]}`)}return o.join("")}toExtendedJSON(){return{$numberDecimal:this.toString()}}static fromExtendedJSON(e){return v.fromString(e.$numberDecimal)}toJSON(){return{$numberDecimal:this.toString()}}[G](){return`new Decimal128("${this.toString()}")`}constructor(e){this._bsontype="Decimal128",this.bytes=void 0,this.bytes=typeof e=="string"?v.fromString(e).bytes:e}};export{v as Decimal128};
